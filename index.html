<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Heart to QR 3D - Nam Helios</title>

    <style>
        :root {
            --primary-color: #ff2fa8;
            --secondary-color: #ff4ecb;
            --accent-color: #00ffff;
            --bg-color: #0a0e2a;
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            background: radial-gradient(ellipse at center, var(--bg-color) 0%, #000000 100%);
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            perspective: 1000px;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .universe {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 5s infinite ease-in-out;
        }

        .container {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
        }

        /* Canvas tr√°i tim */
        #pinkboard {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotateX(0deg) rotateY(0deg); 
            z-index: 2;
            opacity: 1;
            transition: opacity 2.8s ease-in-out;
            filter: drop-shadow(0 0 20px var(--primary-color));
            transform-style: preserve-3d;
            max-width: 95vw;
            max-height: 50vh;
        }

        /* QR container */
        #qr-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8) rotateX(0deg) rotateY(0deg);
            z-index: 4;
            opacity: 0;
            transition: all 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: flex;
            flex-direction: column;
            align-items: center;
            transform-style: preserve-3d;
            width: 80%;
            max-width: 260px;
        }

        #qr-container.show {
            opacity: 1 !important;
            transform: translate(-50%, -50%) scale(1) rotateX(0deg) rotateY(0deg);
            animation: glowPulse 3s infinite ease-in-out;
        }

        #qr-code {
            width: 100%;
            height: auto;
            aspect-ratio: 1 / 1;
            background: #fff;
            padding: 12px;
            border-radius: 18px;
            box-shadow: 
                0 0 30px rgba(255, 52, 144, 0.8),
                0 0 60px rgba(255, 52, 144, 0.4);
            animation: heartbeat 2s infinite ease-in-out;
            transform-style: preserve-3d;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        #qr-code img {
            width: 100%;
            height: 100%;
            border-radius: 12px;
            animation: softShake 3.5s infinite ease-in-out;
        }

        .message {
            margin-top: 15px;
            color: white;
            font-size: clamp(14px, 4vw, 18px);
            opacity: 0;
            transition: opacity 1s ease-in-out;
            text-shadow: 0 0 15px var(--primary-color);
            transform: translateZ(50px);
            text-align: center;
            padding: 0 10px;
            font-weight: 600;
        }

        .message.show {
            opacity: 1 !important;
        }

        /* ‚≠ê D√íNG CH·ªÆ M·ªöI PH√ÅT S√ÅNG */
        .secret-text {
            position: absolute;
            bottom: 15px;
            width: 100%;
            text-align: center;
            font-size: clamp(16px, 5vw, 22px);
            color: var(--secondary-color);
            opacity: 0;
            letter-spacing: 1px;
            font-weight: bold;
            text-shadow: 
                0 0 10px #ff37c9,
                0 0 25px #ff22d7,
                0 0 45px #ff0acb;
            animation: sparkle 2.5s infinite ease-in-out;
            transform: translateZ(30px);
            padding: 0 15px;
            box-sizing: border-box;
        }

        .secret-text.show {
            opacity: 1 !important;
        }

        /* ‚≠ê HI·ªÜU ·ª®NG T·ª™ PANBAP - TR√ÅI TIM NH·ªé R∆†I */
        .falling-heart {
            position: absolute;
            top: -20px;
            color: #ff4da6;
            font-size: clamp(12px, 3.5vw, 16px);
            animation: fall linear forwards;
            pointer-events: none;
            text-shadow: 0 0 12px #ff2ebd;
            transform-style: preserve-3d;
            z-index: 3;
        }

        /* ‚≠ê HI·ªÜU ·ª®NG 3D M·ªöI - V√å SAO BAY */
        .floating-star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: floatStar 15s infinite linear;
            transform-style: preserve-3d;
        }

        /* ‚≠ê HI·ªÜU ·ª®NG 3D M·ªöI - TINH V√ÇN NH·ªé */
        .small-nebula {
            position: absolute;
            border-radius: 50%;
            filter: blur(12px);
            opacity: 0.08;
            animation: smallNebulaFloat 25s infinite ease-in-out;
            transform-style: preserve-3d;
        }

        /* ‚≠ê HI·ªÜU ·ª®NG 3D M·ªöI - C·ª§M SAO NH·ªé */
        .small-star-cluster {
            position: absolute;
            transform-style: preserve-3d;
            animation: smallClusterRotate 15s infinite linear;
        }

        /* ‚≠ê HI·ªÜU ·ª®NG 3D M·ªöI - H·∫†T L∆Ø·ª¢NG T·ª¨ */
        .quantum-dot {
            position: absolute;
            width: 2px;
            height: 2px;
            border-radius: 50%;
            background: #ff00ff;
            animation: quantumPulse 1.5s infinite ease-in-out;
            transform-style: preserve-3d;
            box-shadow: 0 0 6px #ff00ff;
        }

        /* ‚≠ê HI·ªÜU ·ª®NG CHUY·ªÇN TI·∫æP */
        .transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, transparent 30%, var(--bg-color) 70%);
            z-index: 5;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1.5s ease-in-out;
        }

        .transition-overlay.active {
            opacity: 1;
        }

        /* ANIMATIONS */
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        @keyframes floatStar {
            0% {
                transform: translateZ(-300px) translateX(-100vw) translateY(-100vh);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateZ(300px) translateX(100vw) translateY(100vh);
                opacity: 0;
            }
        }

        @keyframes smallNebulaFloat {
            0%, 100% { 
                transform: translateZ(-200px) scale(1) rotate(0deg);
                opacity: 0.06;
            }
            50% { 
                transform: translateZ(-150px) scale(1.1) rotate(90deg);
                opacity: 0.1;
            }
        }

        @keyframes smallClusterRotate {
            from { transform: rotateY(0deg) translateZ(-300px); }
            to { transform: rotateY(360deg) translateZ(-300px); }
        }

        @keyframes quantumPulse {
            0%, 100% { 
                transform: scale(1) translateZ(0);
                opacity: 0.6;
            }
            50% { 
                transform: scale(1.2) translateZ(15px);
                opacity: 1;
            }
        }

        @keyframes fall {
            to {
                transform: translateY(110vh) rotate(360deg) translateZ(50px);
                opacity: 0;
            }
        }

        @keyframes sparkle {
            0%   { opacity: 0.4; transform: scale(1) translateZ(30px); }
            50%  { opacity: 1; transform: scale(1.05) translateZ(50px); }
            100% { opacity: 0.4; transform: scale(1) translateZ(30px); }
        }

        /* EFFECTS QR + HEART */
        @keyframes glowPulse {
            0% { 
                filter: drop-shadow(0 0 10px #ff008c); 
            }
            50% { 
                filter: drop-shadow(0 0 25px #ff20d4); 
            }
            100% { 
                filter: drop-shadow(0 0 10px #ff008c); 
            }
        }

        @keyframes heartbeat {
            0%   { transform: scale(1) translateZ(0); }
            15%  { transform: scale(1.05) translateZ(15px); }
            30%  { transform: scale(1) translateZ(0); }
            45%  { transform: scale(1.05) translateZ(15px); }
            60%  { transform: scale(1) translateZ(0); }
            100% { transform: scale(1) translateZ(0); }
        }

        @keyframes softShake {
            0%   { transform: translate(0,0) translateZ(0); }
            25%  { transform: translate(1px,-1px) translateZ(8px); }
            50%  { transform: translate(-1px, 1px) translateZ(-8px); }
            75%  { transform: translate(1px, 1px) translateZ(4px); }
            100% { transform: translate(0,0) translateZ(0); }
        }

        .credit {
            position: fixed;
            bottom: 4px;
            right: 6px;
            font-size: 8px;
            font-weight: bold;
            opacity: 0.35;
            letter-spacing: 0.5px;
            filter: blur(0.3px);
            background: linear-gradient(
                90deg,
                #ff4ecb,
                #ff9ce3,
                #ffd4f8,
                #ff9ce3,
                #ff4ecb
            );
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: tinyGlow 6s infinite ease-in-out;
            z-index: 9999;
            pointer-events: none;
            user-select: none;
        }

        @keyframes tinyGlow {
            0% { background-position: 0% 50%; opacity: 0.28; }
            50% { background-position: 100% 50%; opacity: 0.42; }
            100% { background-position: 0% 50%; opacity: 0.28; }
        }

        /* Media Queries for Mobile Optimization */
        @media (max-width: 768px) {
            #pinkboard {
                max-width: 85vw;
                max-height: 40vh;
            }
            
            #qr-container {
                width: 75%;
                max-width: 220px;
            }
            
            #qr-code {
                padding: 10px;
                border-radius: 15px;
            }
            
            .message {
                margin-top: 12px;
            }
            
            .secret-text {
                bottom: 12px;
            }
        }

        @media (max-width: 480px) {
            #pinkboard {
                max-width: 80vw;
                max-height: 35vh;
            }
            
            #qr-container {
                width: 70%;
                max-width: 200px;
            }
            
            #qr-code {
                padding: 8px;
                border-radius: 12px;
            }
            
            .secret-text {
                bottom: 10px;
                font-size: clamp(14px, 4.5vw, 18px);
            }
        }

        /* Landscape mode adjustments */
        @media (max-height: 500px) and (orientation: landscape) {
            #pinkboard {
                max-height: 55vh;
            }
            
            #qr-container {
                transform: translate(-50%, -50%) scale(0.7) rotateX(0deg) rotateY(0deg);
            }
            
            #qr-container.show {
                transform: translate(-50%, -50%) scale(0.85) rotateX(0deg) rotateY(0deg);
            }
            
            .secret-text {
                bottom: 8px;
                font-size: 14px;
            }
            
            .message {
                margin-top: 8px;
                font-size: 12px;
            }
        }
    </style>
</head>

<body>
    <div class="universe" id="universe"></div>
    <div class="transition-overlay" id="transitionOverlay"></div>

    <div class="container" id="mainContainer">
        <canvas id="pinkboard"></canvas>

        <div id="qr-container">
            <div id="qr-code">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://me-qr.com/AVSRUIF5" alt="QR Code">
            </div>
            <div class="message">‚ú® Qu√©t m√£ QR ƒë·ªÉ kh√°m ph√° ‚ú®</div>
        </div>

        <div class="secret-text" id="secret">ƒêi·ªÅu G√¨ ƒê∆∞a B·∫°n T·ªõi ƒê√¢y</div>
    </div>

    <script>
        // Ki·ªÉm tra thi·∫øt b·ªã di ƒë·ªông
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

        /* ==============================
           ‚≠ê T·∫†O V≈® TR·ª§ 3D T·ªêI ∆ØU CHO MOBILE
        ===============================*/
        function createUniverse() {
            const universe = document.getElementById('universe');
            
            // TƒÉng s·ªë l∆∞·ª£ng sao ƒë·ªÉ t·∫°o hi·ªáu ·ª©ng phong ph√∫ h∆°n
            const starCount = isMobile ? 100 : 150;
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                const size = Math.random() * 2;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                
                star.style.left = `${Math.random() * 100}vw`;
                star.style.top = `${Math.random() * 100}vh`;
                
                star.style.animationDelay = `${Math.random() * 5}s`;
                
                universe.appendChild(star);
            }

            // T·∫°o hi·ªáu ·ª©ng n·ªÅn
            for (let i = 0; i < (isMobile ? 12 : 18); i++) {
                createFloatingStar();
            }

            for (let i = 0; i < (isMobile ? 3 : 5); i++) {
                createSmallNebula();
            }

            for (let i = 0; i < (isMobile ? 6 : 10); i++) {
                createQuantumDot();
            }
        }

        function createFloatingStar() {
            const star = document.createElement('div');
            star.classList.add('floating-star');
            
            const size = isMobile ? 1 + Math.random() : 1 + Math.random() * 1.5;
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            
            star.style.left = `${Math.random() * 100}vw`;
            star.style.top = `${Math.random() * 100}vh`;
            
            const duration = 6 + Math.random() * 12;
            star.style.animationDuration = `${duration}s`;
            
            const colors = ['#ffffff', '#ff6b6b', '#4ecdc4', '#45b7d1', '#ffbe0b'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            star.style.background = color;
            star.style.boxShadow = `0 0 ${2 + Math.random() * 4}px ${color}`;
            
            document.body.appendChild(star);
        }

        function createSmallNebula() {
            const nebula = document.createElement('div');
            nebula.classList.add('small-nebula');
            
            const size = isMobile ? 40 + Math.random() * 60 : 60 + Math.random() * 80;
            nebula.style.width = `${size}px`;
            nebula.style.height = `${size}px`;
            
            nebula.style.left = `${Math.random() * 100}%`;
            nebula.style.top = `${Math.random() * 100}%`;
            
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#ffbe0b', '#8338ec'];
            const color1 = colors[Math.floor(Math.random() * colors.length)];
            const color2 = colors[Math.floor(Math.random() * colors.length)];
            nebula.style.background = `radial-gradient(circle, ${color1}, ${color2}, transparent)`;
            
            nebula.style.animationDelay = `${Math.random() * 20}s`;
            
            document.body.appendChild(nebula);
        }

        function createQuantumDot() {
            const dot = document.createElement('div');
            dot.classList.add('quantum-dot');
            
            dot.style.left = `${Math.random() * 100}vw`;
            dot.style.top = `${Math.random() * 100}vh`;
            dot.style.animationDelay = `${Math.random() * 2}s`;
            
            const colors = ['#ff00ff', '#00ffff', '#ffff00', '#ff6b6b', '#4ecdc4'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            dot.style.background = color;
            dot.style.boxShadow = `0 0 6px ${color}`;
            
            document.body.appendChild(dot);
        }

        /* ==============================
           ‚≠ê HI·ªÜU ·ª®NG DI CHUY·ªÇN 3D T·ªêI ∆ØU CHO MOBILE
        ===============================*/
        function init3DEffect() {
            const container = document.getElementById('mainContainer');
            
            let mouseX = 0;
            let mouseY = 0;
            let containerX = 0;
            let containerY = 0;
            
            // X·ª≠ l√Ω touch events cho mobile
            if (isTouchDevice) {
                let touchStartX, touchStartY;
                let lastTouchX, lastTouchY;
                let isDragging = false;
                
                document.addEventListener('touchstart', (e) => {
                    if (e.touches.length === 1) {
                        touchStartX = e.touches[0].clientX;
                        touchStartY = e.touches[0].clientY;
                        lastTouchX = touchStartX;
                        lastTouchY = touchStartY;
                        isDragging = true;
                    }
                });
                
                document.addEventListener('touchmove', (e) => {
                    if (e.touches.length === 1 && isDragging) {
                        e.preventDefault();
                        
                        const touchX = e.touches[0].clientX;
                        const touchY = e.touches[0].clientY;
                        
                        // T√≠nh to√°n s·ª± thay ƒë·ªïi v·ªã tr√≠
                        const deltaX = touchX - lastTouchX;
                        const deltaY = touchY - lastTouchY;
                        
                        // C·∫≠p nh·∫≠t g√≥c xoay d·ª±a tr√™n s·ª± di chuy·ªÉn
                        containerX += deltaX * 0.3;
                        containerY += deltaY * 0.3;
                        
                        // Gi·ªõi h·∫°n g√≥c xoay
                        containerX = Math.max(-25, Math.min(25, containerX));
                        containerY = Math.max(-25, Math.min(25, containerY));
                        
                        lastTouchX = touchX;
                        lastTouchY = touchY;
                    }
                });
                
                document.addEventListener('touchend', () => {
                    isDragging = false;
                });
            }
            
            // Animation loop
            function animate() {
                if (!isTouchDevice) {
                    // L√†m m∆∞·ª£t chuy·ªÉn ƒë·ªông v·ªõi easing cho desktop
                    containerX += (mouseX * 12 - containerX) * 0.05;
                    containerY += (mouseY * 12 - containerY) * 0.05;
                }
                
                // √Åp d·ª•ng transform 3D
                container.style.transform = `
                    rotateY(${containerX}deg)
                    rotateX(${-containerY}deg)
                `;
                
                requestAnimationFrame(animate);
            }
            
            animate();
        }

        /* ==============================
           ‚≠ê HI·ªÜU ·ª®NG TR√ÅI TIM R∆†I - TƒÇNG T·∫¶N SU·∫§T
        ===============================*/
        function createFallingHeart() {
            const heart = document.createElement("div");
            heart.classList.add("falling-heart");
            heart.innerHTML = "‚ù§";

            const startX = Math.random() * window.innerWidth;
            heart.style.left = startX + "px";
            
            // ƒêa d·∫°ng k√≠ch th∆∞·ªõc tr√°i tim
            const sizes = [14, 16, 18, 20, 22];
            const randomSize = sizes[Math.floor(Math.random() * sizes.length)];
            heart.style.fontSize = randomSize + "px";
            
            // T·ªëc ƒë·ªô r∆°i ng·∫´u nhi√™n
            const duration = 1.5 + Math.random() * 1.5;
            heart.style.animationDuration = duration + "s";
            
            // Hi·ªáu ·ª©ng m√†u s·∫Øc ƒëa d·∫°ng
            const colors = ['#ff4da6', '#ff6bb5', '#ff8cc7', '#ffadd8', '#ffcee9'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            heart.style.color = randomColor;
            
            // ƒê·ªô m·ªù ban ƒë·∫ßu
            heart.style.opacity = 0.7 + Math.random() * 0.3;

            document.body.appendChild(heart);
            
            // T·ª± ƒë·ªông x√≥a sau khi animation k·∫øt th√∫c
            setTimeout(() => {
                if (heart.parentNode) {
                    heart.remove();
                }
            }, duration * 1000);
        }

        // TƒÉng t·∫ßn su·∫•t t·∫°o tr√°i tim r∆°i
        function startHeartRain() {
            // T·∫°o tr√°i tim ngay l·∫≠p t·ª©c
            createFallingHeart();
            
            // T·∫°o th√™m tr√°i tim v·ªõi t·∫ßn su·∫•t cao
            const heartInterval = isMobile ? 300 : 200; // TƒÉng t·∫ßn su·∫•t: 200-300ms
            setInterval(createFallingHeart, heartInterval);
            
            // Th√™m hi·ªáu ·ª©ng b√πng n·ªï tr√°i tim ban ƒë·∫ßu
            for (let i = 0; i < 15; i++) {
                setTimeout(() => createFallingHeart(), i * 50);
            }
        }

        /* ============================== 
           ‚ö° CODE G·ªêC TR√ÅI TIM TAN + QR V·ªöI HI·ªÜU ·ª®NG CHUY·ªÇN TI·∫æP
        ===============================*/
        var settings = {
            particles: { 
                length: isMobile ? 1800 : 2500,
                duration: 2.2, 
                velocity: 180, 
                effect: -0.7, 
                size: isMobile ? 8 : 12
            },
        };

        var Point=function(x,y){this.x=x||0;this.y=y||0;};
        Point.prototype.clone=function(){return new Point(this.x,this.y);};
        Point.prototype.length=function(l){if(l===undefined)return Math.sqrt(this.x*this.x+this.y*this.y);this.normalize();this.x*=l;this.y*=l;return this;};
        Point.prototype.normalize=function(){var l=this.length();this.x/=l;this.y/=l;return this;};

        var Particle=function(){this.position=new Point();this.velocity=new Point();this.acceleration=new Point();this.age=0;};
        Particle.prototype.initialize=function(x,y,dx,dy){this.position.x=x;this.position.y=y;this.velocity.x=dx;this.velocity.y=dy;this.acceleration.x=dx*settings.particles.effect;this.acceleration.y=dy*settings.particles.effect;this.age=0;};
        Particle.prototype.update=function(dt){this.position.x+=this.velocity.x*dt;this.position.y+=this.velocity.y*dt;this.velocity.x+=this.acceleration.x*dt;this.velocity.y+=this.acceleration.y*dt;this.age+=dt;};
        Particle.prototype.draw=function(ctx,img){function ease(t){return(--t)*t*t+1;}var s=img.width*ease(this.age/settings.particles.duration);ctx.globalAlpha=1-this.age/settings.particles.duration;ctx.drawImage(img,this.position.x-s/2,this.position.y-s/2,s,s);};

        var ParticlePool=function(l){this.particles=new Array(l);for(var i=0;i<l;i++)this.particles[i]=new Particle();this.firstActive=0;this.firstFree=0;this.duration=settings.particles.duration;};

        ParticlePool.prototype.add=function(x,y,dx,dy){this.particles[this.firstFree].initialize(x,y,dx,dy);this.firstFree++;if(this.firstFree===this.particles.length)this.firstFree=0;if(this.firstActive===this.firstFree){this.firstActive++;if(this.firstActive===this.particles.length)this.firstActive=0;}};

        ParticlePool.prototype.update=function(dt){var i;if(this.firstActive<this.firstFree){for(i=this.firstActive;i<this.firstFree;i++)this.particles[i].update(dt);}else{for(i=this.firstActive;i<this.particles.length;i++)this.particles[i].update(dt);for(i=0;i<this.firstFree;i++)this.particles[i].update(dt);}while(this.particles[this.firstActive].age>=this.duration&&this.firstActive!==this.firstFree){this.firstActive++;if(this.firstActive===this.particles.length)this.firstActive=0;}};

        ParticlePool.prototype.draw=function(ctx,img){var i;if(this.firstActive<this.firstFree){for(i=this.firstActive;i<this.firstFree;i++)this.particles[i].draw(ctx,img);}else{for(i=this.firstActive;i<this.particles.length;i++)this.particles[i].draw(ctx,img);for(i=0;i<this.firstFree;i++)this.particles[i].draw(ctx,img);}};

        (function(canvas){
            var ctx=canvas.getContext("2d");
            var particles=new ParticlePool(settings.particles.length);
            var particleRate=settings.particles.length/settings.particles.duration;
            var time;

            var heartPoint=function(t){
                return new Point(
                    160*Math.pow(Math.sin(t),3),
                    130*Math.cos(t)-50*Math.cos(2*t)-20*Math.cos(3*t)-10*Math.cos(4*t)+25
                );
            };

            var img=(function(){
                var c=document.createElement("canvas");
                var cx=c.getContext("2d");
                c.width=c.height=settings.particles.size;
                cx.beginPath();

                var t=-Math.PI,p=convert(t);
                cx.moveTo(p.x,p.y);

                function convert(t){
                    var pt=heartPoint(t);
                    return new Point(
                        c.width/2+pt.x*c.width/350,
                        c.height/2-pt.y*c.height/350
                    );
                }

                while(t<Math.PI){
                    t+=0.01;
                    p=convert(t);
                    cx.lineTo(p.x,p.y);
                }
                cx.fillStyle="#ff3eaa";
                cx.fill();

                var im=new Image();
                im.src=c.toDataURL();
                return im;
            })();

            var start=Date.now();
            var qrShown=false;

            function render(){
                requestAnimationFrame(render);

                var newT=Date.now()/1000;
                var dt=newT-(time||newT);
                time=newT;

                ctx.clearRect(0,0,canvas.width,canvas.height);

                var e=Date.now()-start;

                if(e>4000 && !qrShown){
                    qrShown=true;

                    // Hi·ªáu ·ª©ng chuy·ªÉn ti·∫øp
                    const overlay = document.getElementById('transitionOverlay');
                    overlay.classList.add('active');

                    // Tr√°i tim m·ªù d·∫ßn
                    document.getElementById("pinkboard").style.opacity="0";

                    setTimeout(()=>{
                        // Hi·ªÉn th·ªã QR code
                        document.getElementById("qr-container").classList.add("show");

                        setTimeout(()=>{
                            // Hi·ªÉn th·ªã th√¥ng ƒëi·ªáp
                            document.querySelector(".message").classList.add("show");
                            document.getElementById("secret").classList.add("show");
                            
                            // ·∫®n overlay chuy·ªÉn ti·∫øp
                            setTimeout(() => {
                                overlay.classList.remove('active');
                            }, 1000);
                            
                        },600);

                    },800);
                }

                var effective=particleRate;
                if(e>3000) effective*=Math.max(0,1-(e-3000)/1500);

                var amount=effective*dt;
                for(var i=0;i<amount;i++){
                    var pos=heartPoint(Math.PI-2*Math.PI*Math.random());
                    var dir=pos.clone().length(settings.particles.velocity);
                    particles.add(
                        canvas.width/2+pos.x,
                        canvas.height/2-pos.y,
                        dir.x,-dir.y
                    );
                }

                particles.update(dt);
                particles.draw(ctx,img);
            }

            function resize(){
                const isPortrait = window.innerHeight > window.innerWidth;
                if (isMobile) {
                    canvas.width = window.innerWidth * (isPortrait ? 1 : 1.1);
                    canvas.height = window.innerHeight * (isPortrait ? 1 : 1.1);
                } else {
                    canvas.width = window.innerWidth * 1.1;
                    canvas.height = window.innerHeight * 1.1;
                }
            }
            window.onresize=resize;

            resize();
            render();

        })(document.getElementById("pinkboard"));

        /* ==============================
           ‚≠ê KH·ªûI CH·∫†Y T·∫§T C·∫¢ HI·ªÜU ·ª®NG
        ===============================*/
        function initializeAllEffects() {
            console.log('‚ù§Ô∏è Kh·ªüi t·∫°o h·ªá th·ªëng 3D v·ªõi tr√°i tim tƒÉng c∆∞·ªùng...');
            
            createUniverse();
            init3DEffect();
            startHeartRain(); // B·∫Øt ƒë·∫ßu m∆∞a tr√°i tim v·ªõi t·∫ßn su·∫•t cao

            console.log('üéâ H·ªá th·ªëng 3D mobile ƒë√£ s·∫µn s√†ng!');
        }

        // NgƒÉn scroll tr√™n mobile
        document.addEventListener('touchmove', function(e) {
            if (e.target.tagName !== 'CANVAS') {
                e.preventDefault();
            }
        }, { passive: false });

        window.addEventListener('load', initializeAllEffects);

    </script>
    <div class="credit">cre: ƒêinh B·∫£o Nam</div>
</body>
</html>
